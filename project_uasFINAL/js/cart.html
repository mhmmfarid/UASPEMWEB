<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Keranjang Belanja</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container my-5">
    <h2 class="mb-4 text-success fw-bold">ðŸ›’ Keranjang Belanja</h2>

    <table class="table table-bordered">
        <thead class="table-success">
            <tr>
                <th>Produk</th>  
                <th>Harga</th>
                <th>Qty</th>
                <th>Subtotal</th>
            </tr>
        </thead>
        <tbody id="cart-body"></tbody>
    </table>

    <h4 class="text-end">Total: <span id="cart-total">Rp 0</span></h4>

    <div class="text-end mt-4">
        <button class="btn btn-success btn-lg" onclick="checkoutWhatsapp()">
            Checkout via WhatsApp
        </button>
    </div>
</div>

<script>
    
    // Format mata uang 
    const formatter = new Intl.NumberFormat('id-ID', {
        style: 'currency',
        currency: 'IDR',
        minimumFractionDigits: 0
    });

    //  keranjang dari localStorage
    let cart = JSON.parse(localStorage.getItem('cart')) || [];

    // fungsi render tabel keranjang
    function renderCart() {
        const cartBody = document.getElementById('cart-body');
        const cartTotal = document.getElementById('cart-total');
        if (!cartBody || !cartTotal) return;

        // Debug: Lihat isi keranjang di console
        console.log('Cart items:', cart);
        
        cartBody.innerHTML = '';  
        let total = 0;

        cart.forEach(item => {
            const subtotal = item.price * item.qty;
            total += subtotal;

            // Debug: Cek setiap item di console
            console.log(`Item: ${item.name}, Image: ${item.image}, Image exists: ${!!item.image}`);

            //  render gambar + nama produk
            cartBody.innerHTML += `
                <tr>
                    <td>
                        <img src="${item.image}" alt="${item.name}" 
                             class="img-thumbnail me-2" 
                             style="width: 50px; height: 50px; object-fit: cover;"
                             onerror="this.onerror=null; this.src='https://via.placeholder.com/50/cccccc/999999?text=No+Image';">
                        ${item.name}
                    </td>
                    <td>${formatter.format(item.price)}</td>
                    <td>${item.qty}</td>
                    <td>${formatter.format(subtotal)}</td>
                </tr>
            `;
        });

        // Update total keseluruhan
        cartTotal.textContent = formatter.format(total);
    }

    // Fungsi checkout via WhatsApp (contoh sederhana)
    function checkoutWhatsapp() {
        if (cart.length === 0) {
            alert('Keranjang kosong!');
            return;
        }

        let message = 'Halo, saya ingin memesan:\n';
        cart.forEach(item => {
            message += `- ${item.name} (Qty: ${item.qty}) - ${formatter.format(item.price * item.qty)}\n`;
        });
        message += `Total: ${formatter.format(cart.reduce((sum, item) => sum + item.price * item.qty, 0))}`;

        const whatsappUrl = `https://wa.me/6289687231733?text=${encodeURIComponent(message)}`;  // Ganti nomor WhatsApp admin
        window.open(whatsappUrl, '_blank');
    }

    // Jalankan saat DOM ready
    document.addEventListener('DOMContentLoaded', () => {
        renderCart();
    });
</script>
</body>
</html>